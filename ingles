#!/bin/bash

# Arquivo onde todas as frases ser√£o armazenadas
ARQUIVO="$HOME/Documentos/Ingles/anotacoes.txt"

# Criar diret√≥rio se n√£o existir
mkdir -p "$(dirname "$ARQUIVO")"

# Criar o arquivo se n√£o existir
touch "$ARQUIVO"

# Cores
BRANCO="\e[97m"
AZUL="\e[34m"
VERDE="\e[32m"
VERMELHO="\e[31m"
RESET="\e[0m"

# Adicionar frases ao arquivo (sem limite)
adicionar_frases() {
    echo -e "${AZUL}Digite frases de ingl√™s (inclua a pron√∫ncia entre () e a tradu√ß√£o entre [])."
    echo -e "Pressione Enter sem digitar nada para sair.${RESET}"

    while true; do
        read -p "Frase: " frase
        [[ -z "$frase" ]] && break  # Sai do loop se a entrada estiver vazia
        echo "$frase" >> "$ARQUIVO"
    done

    echo -e "${VERDE}‚úÖ Frases salvas com sucesso!${RESET}"
}

# Exibir todas as frases salvas (com espa√ßamento)
exibir_frases() {
    if [[ -s "$ARQUIVO" ]]; then
        echo -e "\nüìñ ${BRANCO}Frases salvas:${RESET}"
        echo -e ""  # Espa√ßo antes de exibir as frases
        while IFS= read -r linha; do
            frase=$(echo "$linha" | sed -E 's/\(.*\)//' | sed -E 's/\[.*\]//')
            pronuncia=$(echo "$linha" | grep -oP '\(.*?\)')
            traducao=$(echo "$linha" | grep -oP '\[.*?\]')

            echo -e "${BRANCO}Frase: $frase${RESET}"
            [[ -n "$pronuncia" ]] && echo -e "${AZUL}Pron√∫ncia: $pronuncia${RESET}"
            [[ -n "$traducao" ]] && echo -e "${VERDE}Tradu√ß√£o: $traducao${RESET}"
            echo ""
        done < "$ARQUIVO"
    else
        echo -e "${VERMELHO}Nenhuma frase adicionada ainda.${RESET}"
    fi
}

# Pesquisar frases por palavra-chave e exibir frase completa (com espa√ßamento)
pesquisar_frases() {
    echo -e "${AZUL}Digite o termo de busca:${RESET}"
    read termo

    resultado=$(grep -i --color=never "$termo" "$ARQUIVO" 2>/dev/null)

    if [[ -z "$resultado" ]]; then
        echo -e "${VERMELHO}Nenhuma frase encontrada.${RESET}"
    else
        echo -e "\nüîé ${BRANCO}Resultados encontrados:${RESET}"
        echo -e ""  # Espa√ßo antes de exibir os resultados da pesquisa
        echo -e "$resultado" | while IFS= read -r linha; do
            frase=$(echo "$linha" | sed -E 's/\(.*\)//' | sed -E 's/\[.*\]//')
            pronuncia=$(echo "$linha" | grep -oP '\(.*?\)')
            traducao=$(echo "$linha" | grep -oP '\[.*?\]')

            echo -e "${BRANCO}Frase: $frase${RESET}"
            [[ -n "$pronuncia" ]] && echo -e "${AZUL}Pron√∫ncia: $pronuncia${RESET}"
            [[ -n "$traducao" ]] && echo -e "${VERDE}Tradu√ß√£o: $traducao${RESET}"
            echo ""
        done
    fi
}

# Menu principal
while true; do
    echo -e "\nüìö ${BRANCO}Di√°rio de Ingl√™s - Anota√ß√µes Ilimitadas${RESET}"
    echo -e ""  # Adiciona o espa√ßo entre o t√≠tulo e as op√ß√µes
    echo -e "1) ‚úèÔ∏è  Adicionar frases"
    echo -e "2) üìñ Ver todas as frases"
    echo -e "3) üîç Pesquisar frases"
    echo -e "4) ‚ùå Sair"
    read -p "Escolha uma op√ß√£o: " opcao

    case $opcao in
        1) adicionar_frases ;;
        2) exibir_frases ;;
        3) pesquisar_frases ;;
        4) echo -e "${VERMELHO}Saindo...${RESET}"; exit 0 ;;
        *) echo -e "${VERMELHO}Op√ß√£o inv√°lida!${RESET}" ;;
    esac
done
